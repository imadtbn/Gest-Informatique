<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام تسيير حظيرة الإعلام الآلي</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        
        .navbar-custom {
            background-color: var(--primary-color);
        }
        
        .sidebar {
            background-color: var(--dark-color);
            color: white;
            height: calc(100vh - 56px);
            position: sticky;
            top: 56px;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar .nav-link:hover {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .sidebar .nav-link.active {
            color: white;
            background-color: var(--secondary-color);
        }
        
        .card-custom {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        
        .card-custom:hover {
            transform: translateY(-5px);
        }
        
        .btn-custom {
            background-color: var(--secondary-color);
            color: white;
            border: none;
        }
        
        .btn-custom:hover {
            background-color: #2980b9;
            color: white;
        }
        
        .btn-maintenance {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-maintenance:hover {
            background-color: #c0392b;
            color: white;
        }
        
        .table-custom th {
            background-color: var(--primary-color);
            color: white;
        }
        
        .search-box {
            border-radius: 20px;
            border: 1px solid #ced4da;
            padding: 0.375rem 0.75rem;
        }
        
        .stat-box {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .accessory-item {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            .print-section {
                display: block !important;
            }
        }
    </style>
</head>
<body>
    <!-- شريط التنقل -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-laptop-house me-2"></i>
                نظام تسيير حظيرة الإعلام الآلي
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-user me-1"></i> تسجيل الدخول</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-cog me-1"></i> الإعدادات</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- الشريط الجانبي -->
            <div class="col-lg-2 col-md-3 p-0 no-print">
                <div class="sidebar">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#">
                                <i class="fas fa-home me-2"></i> لوحة التحكم
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-users me-2"></i> إدارة العمال
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-desktop me-2"></i> إدارة الأجهزة
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-print me-2"></i> إدارة الملحقات
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-file-contract me-2"></i> وثائق التسليم
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-tools me-2"></i> طلبات الصيانة
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-network-wired me-2"></i> إدارة الشبكة
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-chart-bar me-2"></i> التقارير والإحصائيات
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- المحتوى الرئيسي -->
            <div class="col-lg-10 col-md-9 py-4">
                <div class="d-flex justify-content-between align-items-center mb-4 no-print">
                    <h2>لوحة التحكم الرئيسية</h2>
                    <div>
                        <button class="btn btn-custom me-2" data-bs-toggle="modal" data-bs-target="#addEmployeeModal">
                            <i class="fas fa-user-plus me-1"></i> إضافة عامل
                        </button>
                        <button class="btn btn-custom" data-bs-toggle="modal" data-bs-target="#addDeviceModal">
                            <i class="fas fa-desktop me-1"></i> إضافة جهاز
                        </button>
                    </div>
                </div>

                <!-- إحصائيات سريعة -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="stat-box text-center">
                            <h3 id="employees-count">0</h3>
                            <p>عدد العمال</p>
                            <i class="fas fa-users fa-2x"></i>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-box text-center">
                            <h3 id="devices-count">0</h3>
                            <p>عدد الأجهزة</p>
                            <i class="fas fa-desktop fa-2x"></i>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-box text-center">
                            <h3 id="maintenance-count">0</h3>
                            <p>أجهزة تحت الصيانة</p>
                            <i class="fas fa-tools fa-2x"></i>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-box text-center">
                            <h3 id="requests-count">0</h3>
                            <p>طلبات جديدة</p>
                            <i class="fas fa-file-alt fa-2x"></i>
                        </div>
                    </div>
                </div>

                <!-- شريط البحث والأزرار -->
                <div class="card card-custom mb-4 no-print">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="input-group">
                                    <input type="text" class="form-control search-box" id="search-input" placeholder="ابحث في جميع البيانات...">
                                    <button class="btn btn-custom" id="search-btn">
                                        <i class="fas fa-search"></i> بحث
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-4 text-left">
                                <button class="btn btn-success me-2" id="export-btn">
                                    <i class="fas fa-file-excel me-1"></i> تصدير إكسيل
                                </button>
                                <button class="btn btn-primary me-2" id="print-btn">
                                    <i class="fas fa-print me-1"></i> طباعة
                                </button>
                                <button class="btn btn-secondary" id="save-btn">
                                    <i class="fas fa-save me-1"></i> حفظ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- جدول العمال -->
                <div class="card card-custom mb-4">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-users me-2"></i> قائمة العمال</h5>
                        <span class="badge bg-light text-dark" id="employees-badge">0</span>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="employees-table">
                                <thead>
                                    <tr>
                                        <th>رقم التسجيل</th>
                                        <th>الاسم الكامل</th>
                                        <th>الوظيفة</th>
                                        <th>المصلحة</th>
                                        <th>جهاز الكمبيوتر</th>
                                        <th>الاختصاص</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- سيتم ملؤها ديناميكياً -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- جدول الأجهزة -->
                <div class="card card-custom">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-desktop me-2"></i> قائمة الأجهزة</h5>
                        <span class="badge bg-light text-dark" id="devices-badge">0</span>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="devices-table">
                                <thead>
                                    <tr>
                                        <th>اسم الجهاز</th>
                                        <th>الرقم التسلسلي</th>
                                        <th>العلامة</th>
                                        <th>الطراز</th>
                                        <th>المستخدم</th>
                                        <th>عنوان IP</th>
                                        <th>عنوان MAC</th>
                                        <th>الحالة</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- سيتم ملؤها ديناميكياً -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نموذج إضافة عامل (Modal) -->
    <div class="modal fade" id="addEmployeeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">إضافة عامل جديد</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="employee-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">الاسم الكامل *</label>
                                    <input type="text" class="form-control" id="employee-name" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">رقم التسجيل *</label>
                                    <input type="text" class="form-control" id="employee-id" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">الوظيفة *</label>
                                    <input type="text" class="form-control" id="employee-job" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">المصلحة *</label>
                                    <select class="form-select" id="employee-department" required>
                                        <option value="" selected disabled>اختر المصلحة...</option>
                                        <option>مصلحة الموارد البشرية</option>
                                        <option>مصلحة الشؤون القانونية</option>
                                        <option>مصلحة المعلوماتية</option>
                                        <option>مصلحة المالية</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">جهاز الكمبيوتر</label>
                                    <select class="form-select" id="employee-computer">
                                        <option value="" selected>لا يوجد</option>
                                        <!-- سيتم ملؤها ديناميكياً -->
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">الاختصاص</label>
                                    <input type="text" class="form-control" id="employee-specialty">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">الشهادات المتحصل عليها</label>
                            <textarea class="form-control" id="employee-certificates" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-custom" id="save-employee-btn">حفظ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- نموذج إضافة جهاز (Modal) -->
    <div class="modal fade" id="addDeviceModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">إضافة جهاز جديد</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="device-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">اسم الجهاز *</label>
                                    <input type="text" class="form-control" id="device-name" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">الرقم التسلسلي *</label>
                                    <input type="text" class="form-control" id="device-serial" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">العلامة *</label>
                                    <input type="text" class="form-control" id="device-brand" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">الطراز *</label>
                                    <input type="text" class="form-control" id="device-model" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">عنوان IP</label>
                                    <input type="text" class="form-control" id="device-ip">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">عنوان MAC</label>
                                    <input type="text" class="form-control" id="device-mac">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">المستخدم</label>
                            <select class="form-select" id="device-user">
                                <option value="" selected>لا يوجد</option>
                                <!-- سيتم ملؤها ديناميكياً -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">الملحقات</label>
                            <div id="accessories-container">
                                <!-- سيتم إضافة الملحقات هنا -->
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-secondary mt-2" id="add-accessory-btn">
                                <i class="fas fa-plus me-1"></i> إضافة ملحق
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-custom" id="save-device-btn">حفظ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- نموذج الصيانة (Modal) -->
    <div class="modal fade" id="maintenanceModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">طلب صيانة</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="maintenance-form">
                        <div class="mb-3">
                            <label class="form-label">اسم الجهاز/الملحق</label>
                            <input type="text" class="form-control" id="maintenance-item" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">الرقم التسلسلي</label>
                            <input type="text" class="form-control" id="maintenance-serial" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">سبب العطل *</label>
                            <textarea class="form-control" id="maintenance-reason" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ورشة التصليح *</label>
                            <select class="form-select" id="maintenance-workshop" required>
                                <option value="" selected disabled>اختر ورشة التصليح...</option>
                                <option>الورشة المركزية</option>
                                <option>الورشة الخارجية - تقنيات</option>
                                <option>الورشة الخارجية - ديجيتال</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-maintenance" id="save-maintenance-btn">إرسال الطلب</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap & jQuery JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- مكتبة لتصدير البيانات إلى Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <script>
        // بيانات التخزين
        let employees = JSON.parse(localStorage.getItem('employees')) || [];
        let devices = JSON.parse(localStorage.getItem('devices')) || [];
        let maintenanceRequests = JSON.parse(localStorage.getItem('maintenanceRequests')) || [];

        // عناصر واجهة المستخدم
        const employeeForm = document.getElementById('employee-form');
        const deviceForm = document.getElementById('device-form');
        const maintenanceForm = document.getElementById('maintenance-form');
        
        // تهيئة النظام عند التحميل
        $(document).ready(function() {
            updateComputerDropdown();
            updateUserDropdown();
            loadEmployees();
            loadDevices();
            updateStats();
            
            // تفعيل زر حفظ العامل
            $('#save-employee-btn').click(function() {
                if ($('#employee-form')[0].checkValidity()) {
                    saveEmployee();
                    $('#addEmployeeModal').modal('hide');
                } else {
                    $('#employee-form')[0].reportValidity();
                }
            });
            
            // تفعيل زر حفظ الجهاز
            $('#save-device-btn').click(function() {
                if ($('#device-form')[0].checkValidity()) {
                    saveDevice();
                    $('#addDeviceModal').modal('hide');
                } else {
                    $('#device-form')[0].reportValidity();
                }
            });
            
            // تفعيل زر إضافة ملحق
            $('#add-accessory-btn').click(function() {
                addAccessoryField();
            });
            
            // تفعيل زر البحث
            $('#search-btn').click(function() {
                searchData();
            });
            
            // تفعيل زر التصدير
            $('#export-btn').click(function() {
                exportToExcel();
            });
            
            // تفعيل زر الطباعة
            $('#print-btn').click(function() {
                window.print();
            });
            
            // تفعيل زر الحفظ
            $('#save-btn').click(function() {
                saveData();
                alert('تم حفظ البيانات بنجاح في المتصفح');
            });
            
            // إضافة بعض البيانات الافتراضية إذا لم تكن هناك بيانات
            if (employees.length === 0 && devices.length === 0) {
                addSampleData();
            }
        });

        // وظائف النظام
        function saveEmployee() {
            const employee = {
                id: $('#employee-id').val(),
                name: $('#employee-name').val(),
                job: $('#employee-job').val(),
                department: $('#employee-department').val(),
                computer: $('#employee-computer').val(),
                specialty: $('#employee-specialty').val(),
                certificates: $('#employee-certificates').val()
            };
            
            employees.push(employee);
            saveData();
            loadEmployees();
            updateStats();
            employeeForm.reset();
        }

        function saveDevice() {
            const accessories = [];
            $('.accessory-item').each(function() {
                const type = $(this).find('.accessory-type').val();
                const serial = $(this).find('.accessory-serial').val();
                const brand = $(this).find('.accessory-brand').val();
                const model = $(this).find('.accessory-model').val();
                
                if (type && serial) {
                    accessories.push({ type, serial, brand, model });
                }
            });
            
            const device = {
                name: $('#device-name').val(),
                serial: $('#device-serial').val(),
                brand: $('#device-brand').val(),
                model: $('#device-model').val(),
                ip: $('#device-ip').val(),
                mac: $('#device-mac').val(),
                user: $('#device-user').val(),
                accessories: accessories,
                status: 'يعمل'
            };
            
            devices.push(device);
            saveData();
            loadDevices();
            updateStats();
            deviceForm.reset();
            $('#accessories-container').empty();
        }

        function loadEmployees() {
            const tableBody = $('#employees-table tbody');
            tableBody.empty();
            
            employees.forEach(employee => {
                const row = `
                    <tr>
                        <td>${employee.id}</td>
                        <td>${employee.name}</td>
                        <td>${employee.job}</td>
                        <td>${employee.department}</td>
                        <td>${employee.computer || 'لا يوجد'}</td>
                        <td>${employee.specialty || 'لا يوجد'}</td>
                        <td>
                            <button class="btn btn-sm btn-custom" onclick="editEmployee('${employee.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteEmployee('${employee.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn btn-sm btn-maintenance" onclick="requestMaintenance('${employee.id}', 'employee', '${employee.name}', '${employee.id}')">
                                <i class="fas fa-tools"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tableBody.append(row);
            });
            
            $('#employees-badge').text(employees.length);
        }

        function loadDevices() {
            const tableBody = $('#devices-table tbody');
            tableBody.empty();
            
            devices.forEach(device => {
                const statusClass = device.status === 'يعمل' ? 'bg-success' : 'bg-warning';
                const row = `
                    <tr>
                        <td>${device.name}</td>
                        <td>${device.serial}</td>
                        <td>${device.brand}</td>
                        <td>${device.model}</td>
                        <td>${device.user || 'لا يوجد'}</td>
                        <td>${device.ip || 'لا يوجد'}</td>
                        <td>${device.mac || 'لا يوجد'}</td>
                        <td><span class="badge ${statusClass}">${device.status}</span></td>
                        <td>
                            <button class="btn btn-sm btn-custom" onclick="editDevice('${device.serial}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteDevice('${device.serial}')">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn btn-sm btn-maintenance" onclick="requestMaintenance('${device.serial}', 'device', '${device.name}', '${device.serial}')">
                                <i class="fas fa-tools"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tableBody.append(row);
            });
            
            $('#devices-badge').text(devices.length);
            updateComputerDropdown();
            updateUserDropdown();
        }

        function updateStats() {
            $('#employees-count').text(employees.length);
            $('#devices-count').text(devices.length);
            $('#maintenance-count').text(devices.filter(d => d.status === 'تحت الصيانة').length);
            $('#requests-count').text(maintenanceRequests.length);
        }

        function updateComputerDropdown() {
            const dropdown = $('#employee-computer');
            dropdown.empty();
            dropdown.append('<option value="" selected>لا يوجد</option>');
            
            devices.forEach(device => {
                if (!device.user) { // فقط الأجهزة التي ليس لها مستخدم
                    dropdown.append(`<option value="${device.name}">${device.name} (${device.brand} ${device.model})</option>`);
                }
            });
        }

        function updateUserDropdown() {
            const dropdown = $('#device-user');
            dropdown.empty();
            dropdown.append('<option value="" selected>لا يوجد</option>');
            
            employees.forEach(employee => {
                dropdown.append(`<option value="${employee.name}">${employee.name} (${employee.department})</option>`);
            });
        }

        function addAccessoryField() {
            const accessoryHtml = `
                <div class="accessory-item">
                    <div class="row">
                        <div class="col-md-3">
                            <select class="form-select form-select-sm accessory-type">
                                <option value="" selected disabled>نوع الملحق</option>
                                <option>وحدة مركزية</option>
                                <option>شاشة</option>
                                <option>لوحة مفاتيح</option>
                                <option>فأرة</option>
                                <option>طابعة</option>
                                <option>محول الشبكة</option>
                                <option>مموج كهربائي</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control form-control-sm accessory-serial" placeholder="الرقم التسلسلي">
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control form-control-sm accessory-brand" placeholder="العلامة">
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control form-control-sm accessory-model" placeholder="الطراز">
                        </div>
                    </div>
                </div>
            `;
            $('#accessories-container').append(accessoryHtml);
        }

        function requestMaintenance(id, type, name, serial) {
            $('#maintenance-item').val(name);
            $('#maintenance-serial').val(serial);
            $('#maintenanceModal').data('id', id);
            $('#maintenanceModal').data('type', type);
            $('#maintenanceModal').modal('show');
        }

        // تفعيل زر حفظ طلب الصيانة
        $('#save-maintenance-btn').click(function() {
            if ($('#maintenance-form')[0].checkValidity()) {
                const id = $('#maintenanceModal').data('id');
                const type = $('#maintenanceModal').data('type');
                const reason = $('#maintenance-reason').val();
                const workshop = $('#maintenance-workshop').val();
                
                const request = {
                    id: Date.now(),
                    itemId: id,
                    itemType: type,
                    itemName: $('#maintenance-item').val(),
                    itemSerial: $('#maintenance-serial').val(),
                    reason: reason,
                    workshop: workshop,
                    date: new Date().toLocaleDateString('ar-EG'),
                    status: 'معلق'
                };
                
                maintenanceRequests.push(request);
                
                // إذا كان الطلب لجهاز، قم بتغيير حالته
                if (type === 'device') {
                    const device = devices.find(d => d.serial === id);
                    if (device) {
                        device.status = 'تحت الصيانة';
                    }
                }
                
                saveData();
                loadDevices();
                updateStats();
                $('#maintenanceModal').modal('hide');
                maintenanceForm.reset();
                
                alert('تم إرسال طلب الصيانة بنجاح');
            } else {
                $('#maintenance-form')[0].reportValidity();
            }
        });

        function searchData() {
            const searchText = $('#search-input').val().toLowerCase();
            
            // البحث في العمال
            $('#employees-table tbody tr').each(function() {
                const rowText = $(this).text().toLowerCase();
                $(this).toggle(rowText.includes(searchText));
            });
            
            // البحث في الأجهزة
            $('#devices-table tbody tr').each(function() {
                const rowText = $(this).text().toLowerCase();
                $(this).toggle(rowText.includes(searchText));
            });
        }

        function exportToExcel() {
            // تحضير بيانات العمال للتصدير
            const employeeData = employees.map(emp => ({
                'رقم التسجيل': emp.id,
                'الاسم الكامل': emp.name,
                'الوظيفة': emp.job,
                'المصلحة': emp.department,
                'جهاز الكمبيوتر': emp.computer || 'لا يوجد',
                'الاختصاص': emp.specialty || 'لا يوجد',
                'الشهادات': emp.certificates || 'لا يوجد'
            }));
            
            // تحضير بيانات الأجهزة للتصدير
            const deviceData = devices.map(dev => ({
                'اسم الجهاز': dev.name,
                'الرقم التسلسلي': dev.serial,
                'العلامة': dev.brand,
                'الطراز': dev.model,
                'المستخدم': dev.user || 'لا يوجد',
                'عنوان IP': dev.ip || 'لا يوجد',
                'عنوان MAC': dev.mac || 'لا يوجد',
                'الحالة': dev.status
            }));
            
            // إنشاء مصنف Excel مع ورقتين
            const wb = XLSX.utils.book_new();
            const wsEmployees = XLSX.utils.json_to_sheet(employeeData);
            const wsDevices = XLSX.utils.json_to_sheet(deviceData);
            
            XLSX.utils.book_append_sheet(wb, wsEmployees, "الموظفون");
            XLSX.utils.book_append_sheet(wb, wsDevices, "الأجهزة");
            
            // حفظ الملف
            XLSX.writeFile(wb, "حظيرة_الإعلام_الآلي.xlsx");
        }

        function saveData() {
            localStorage.setItem('employees', JSON.stringify(employees));
            localStorage.setItem('devices', JSON.stringify(devices));
            localStorage.setItem('maintenanceRequests', JSON.stringify(maintenanceRequests));
        }

        function addSampleData() {
            // بيانات عمال نموذجية
            employees = [
                {
                    id: 'EMP-001',
                    name: 'أحمد محمد',
                    job: 'مسؤول إعلام آلي',
                    department: 'مصلحة الموارد البشرية',
                    computer: 'PC-025',
                    specialty: 'شبكات الحاسوب',
                    certificates: 'شهادة تقني سامي في الإعلام الآلي'
                },
                {
                    id: 'EMP-002',
                    name: 'فاطمة الزهراء',
                    job: 'مساعد إداري',
                    department: 'مصلحة الشؤون القانونية',
                    computer: 'PC-042',
                    specialty: 'إدارة أعمال',
                    certificates: 'شهادة تقني في الإدارة'
                }
            ];
            
            // بيانات أجهزة نموذجية
            devices = [
                {
                    name: 'PC-025',
                    serial: 'SN-789456',
                    brand: 'Dell',
                    model: 'Optiplex 7050',
                    ip: '192.168.1.25',
                    mac: '00:1A:2B:3C:4D:5E',
                    user: 'أحمد محمد',
                    accessories: [
                        { type: 'شاشة', serial: 'MON-001', brand: 'Dell', model: 'P2219H' },
                        { type: 'لوحة مفاتيح', serial: 'KB-001', brand: 'Dell', model: 'KB216' },
                        { type: 'فأرة', serial: 'MS-001', brand: 'Dell', model: 'MS116' }
                    ],
                    status: 'يعمل'
                },
                {
                    name: 'PC-042',
                    serial: 'SN-123456',
                    brand: 'HP',
                    model: 'ProDesk 600',
                    ip: '192.168.1.42',
                    mac: '00:1B:2C:3D:4E:5F',
                    user: 'فاطمة الزهراء',
                    accessories: [
                        { type: 'شاشة', serial: 'MON-002', brand: 'HP', model: 'E243' },
                        { type: 'لوحة مفاتيح', serial: 'KB-002', brand: 'HP', model: 'USB Keyboard' },
                        { type: 'فأرة', serial: 'MS-002', brand: 'HP', model: 'USB Mouse' }
                    ],
                    status: 'يعمل'
                }
            ];
            
            saveData();
            loadEmployees();
            loadDevices();
            updateStats();
        }

        // وظائف التعديل والحذف
        function editEmployee(id) {
            const employee = employees.find(emp => emp.id === id);
            if (employee) {
                $('#employee-id').val(employee.id);
                $('#employee-name').val(employee.name);
                $('#employee-job').val(employee.job);
                $('#employee-department').val(employee.department);
                $('#employee-computer').val(employee.computer);
                $('#employee-specialty').val(employee.specialty);
                $('#employee-certificates').val(employee.certificates);
                
                $('#addEmployeeModal').modal('show');
                
                // حذف الموظف القديم بعد التعديل
                deleteEmployee(id, false);
            }
        }

        function deleteEmployee(id, confirm = true) {
            if (!confirm || confirm('هل أنت متأكد من حذف هذا العامل؟')) {
                employees = employees.filter(emp => emp.id !== id);
                saveData();
                loadEmployees();
                updateStats();
            }
        }

        function editDevice(serial) {
            const device = devices.find(dev => dev.serial === serial);
            if (device) {
                $('#device-name').val(device.name);
                $('#device-serial').val(device.serial);
                $('#device-brand').val(device.brand);
                $('#device-model').val(device.model);
                $('#device-ip').val(device.ip);
                $('#device-mac').val(device.mac);
                $('#device-user').val(device.user);
                
                // إضافة الملحقات
                $('#accessories-container').empty();
                device.accessories.forEach(acc => {
                    addAccessoryField();
                    const lastItem = $('.accessory-item').last();
                    lastItem.find('.accessory-type').val(acc.type);
                    lastItem.find('.accessory-serial').val(acc.serial);
                    lastItem.find('.accessory-brand').val(acc.brand);
                    lastItem.find('.accessory-model').val(acc.model);
                });
                
                $('#addDeviceModal').modal('show');
                
                // حذف الجهاز القديم بعد التعديل
                deleteDevice(serial, false);
            }
        }

        function deleteDevice(serial, confirm = true) {
            if (!confirm || confirm('هل أنت متأكد من حذف هذا الجهاز؟')) {
                devices = devices.filter(dev => dev.serial !== serial);
                saveData();
                loadDevices();
                updateStats();
            }
        }
    </script>
</body>
</html>